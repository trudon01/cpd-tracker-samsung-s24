#:kivy 2.0

ScreenManager:
    CPDScreen:

<CPDScreen>:
    name: "cpd"
    canvas.before:
        Color:
            rgba: 1, 1, 1, 1  # White background
        Rectangle:
            pos: self.pos
            size: self.size
    
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        bar_width: "15dp"
        scroll_type: ["bars", "content"]
        effect_cls: "ScrollEffect"
        bar_color: [0.7, 0.7, 0.7, 0.9]
        bar_inactive_color: [0.7, 0.7, 0.7, 0.5]
        
        # Main container - Compact layout with better scrolling
        BoxLayout:
            orientation: "vertical"
            padding: "10dp", "5dp", "10dp", "10dp"  # Minimal top padding
            spacing: "15dp"  # Reduced spacing between sections
            size_hint_y: None
            height: self.minimum_height + dp(100)  # More extra space for scrolling
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1  # Solid white background
                Rectangle:
                    pos: self.pos
                    size: self.size
            
            # Header - Ultra Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "45dp"  # Even smaller
                spacing: "2dp"  # Minimal spacing
                
                Label:
                    text: "CPD Activity Entry"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "20sp"  # Smaller font
                    bold: True
                    halign: "center"
                    size_hint_y: None
                    height: "35dp"  # Reduced height
                    text_size: self.size
                    
                Widget:
                    size_hint_y: None
                    height: "8dp"  # Minimal spacer
                
            # Date Section - Ultra Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "110dp"  # Even smaller
                spacing: "8dp"  # Minimal spacing
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üìÖ Activity Dates"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "15sp"  # Smaller font
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "25dp"  # Smaller height
                    text_size: self.size
                    
                # Start Date Row - Ultra Compact
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "38dp"  # Smaller height
                    spacing: "8dp"
                    
                    Label:
                        text: "Start:"
                        color: 0.3, 0.3, 0.3, 1
                        font_size: "13sp"  # Smaller font
                        size_hint_x: 0.2
                        halign: "left"
                        valign: "center"
                        text_size: self.size
                        
                    Button:
                        id: date_start_btn
                        text: "üìÖ Select Start Date"
                        background_color: 0.9, 0.9, 0.9, 1
                        color: 0.2, 0.2, 0.2, 1
                        font_size: "12sp"  # Smaller font
                        size_hint_x: 0.8
                        on_release: root.show_date_picker("start")
                        
                # End Date Row - Ultra Compact
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "38dp"  # Smaller height
                    spacing: "8dp"
                    
                    Label:
                        text: "End:"
                        color: 0.3, 0.3, 0.3, 1
                        font_size: "13sp"  # Smaller font
                        size_hint_x: 0.2
                        halign: "left"
                        valign: "center"
                        text_size: self.size
                        
                    Button:
                        id: date_end_btn
                        text: "üìÖ Select End Date"
                        background_color: 0.9, 0.9, 0.9, 1
                        color: 0.2, 0.2, 0.2, 1
                        font_size: "12sp"  # Smaller font
                        size_hint_x: 0.8
                        on_release: root.show_date_picker("end")
                        
            # Activity Details Section - Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "100dp"  # Much smaller
                spacing: "10dp"  # Reduced spacing
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üìù Activity Details"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "16sp"  # Smaller font
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "30dp"  # Smaller height
                    text_size: self.size
                    
                TextInput:
                    id: name
                    hint_text: "Activity Name"
                    multiline: False
                    font_size: "14sp"  # Smaller font
                    size_hint_y: None
                    height: "60dp"  # Smaller height
                    padding: [10, 15]  # Less padding
                    
            # Points Section - New
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "100dp"  # Compact height
                spacing: "10dp"
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üèÜ CPD Points"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "16sp"
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "30dp"
                    text_size: self.size
                    
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: "60dp"
                    spacing: "10dp"
                    
                    Label:
                        text: "Points:"
                        color: 0.3, 0.3, 0.3, 1
                        font_size: "14sp"
                        size_hint_x: 0.2
                        halign: "left"
                        valign: "center"
                        text_size: self.size
                        
                    Button:
                        id: points_btn
                        text: "Select Points (Optional)"
                        background_color: 0.9, 0.9, 0.9, 1
                        color: 0.2, 0.2, 0.2, 1
                        font_size: "13sp"
                        size_hint_x: 0.8
                        on_release: root.show_points_selector()
                    
            # Type Selection - Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "170dp"  # Much smaller
                spacing: "10dp"  # Reduced spacing
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üè∑Ô∏è Activity Type"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "16sp"  # Smaller font
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "30dp"  # Smaller height
                    text_size: self.size
            
                # First row of type buttons - Compact
                BoxLayout:
                    orientation: "horizontal"
                    spacing: "10dp"  # Reduced spacing
                    size_hint_y: None
                    height: "50dp"  # Smaller height
                    
                    Button:
                        id: type_paper
                        text: "üìÑ Paper"
                        font_size: "12sp"  # Smaller font
                        on_release: root.select_type("Paper")
                        
                    Button:
                        id: type_conference
                        text: "üéØ Conference"
                        font_size: "12sp"  # Smaller font
                        on_release: root.select_type("Conference")
                        
                    Button:
                        id: type_project
                        text: "üíº Project"
                        font_size: "12sp"  # Smaller font
                        on_release: root.select_type("Project")
                
                # Second row of type buttons - Compact
                BoxLayout:
                    orientation: "horizontal"
                    spacing: "10dp"  # Reduced spacing
                    size_hint_y: None
                    height: "50dp"  # Smaller height
                    
                    Button:
                        id: type_course
                        text: "üéì Course"
                        font_size: "12sp"  # Smaller font
                        on_release: root.select_type("Course")
                        
                    Button:
                        id: type_other
                        text: "üìã Other"
                        font_size: "12sp"  # Smaller font
                        on_release: root.select_type("Other")
                        
                    Widget:  # Spacer
                
                # Selection status - Compact
                Label:
                    id: selected_type
                    text: "No type selected"
                    color: 0.6, 0.6, 0.6, 1
                    font_size: "14sp"  # Smaller font
                    halign: "center"
                    size_hint_y: None
                    height: "40dp"  # Smaller height
                    text_size: self.size
                    
            # Description - Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "140dp"  # Much smaller
                spacing: "10dp"  # Reduced spacing
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üìã Description / Other Details"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "16sp"  # Smaller font
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "30dp"  # Smaller height
                    text_size: self.size
                    
                TextInput:
                    id: description
                    hint_text: "Provide detailed information about the activity..."
                    multiline: True
                    font_size: "14sp"  # Smaller font
                    size_hint_y: None
                    height: "100dp"  # Smaller height
                    padding: [10, 10]  # Less padding
                    
            # Photo Section - Compact
            BoxLayout:
                orientation: "vertical"
                size_hint_y: None
                height: "110dp"  # Much smaller
                spacing: "10dp"  # Reduced spacing
                canvas.before:
                    Color:
                        rgba: 0.95, 0.95, 0.95, 1
                    Rectangle:
                        pos: self.pos
                        size: self.size
                
                Label:
                    text: "üì∑ Photo Evidence"
                    color: 0.2, 0.4, 0.8, 1
                    font_size: "16sp"  # Smaller font
                    bold: True
                    halign: "left"
                    size_hint_y: None
                    height: "30dp"  # Smaller height
                    text_size: self.size
                    
                BoxLayout:
                    orientation: "horizontal"
                    spacing: "10dp"  # Reduced spacing
                    size_hint_y: None
                    height: "70dp"  # Smaller height
                    
                    Button:
                        text: "üì∑ Take Photo"
                        font_size: "14sp"  # Smaller font
                        background_color: 0.3, 0.7, 0.3, 1
                        on_release: root.take_photo()
                        size_hint_x: 0.6
                        
                    Label:
                        id: photo_status
                        text: "No photo taken"
                        color: 0.6, 0.6, 0.6, 1
                        font_size: "12sp"  # Smaller font
                        size_hint_x: 0.4
                        halign: "left"
                        valign: "center"
                        text_size: self.size
                        
            # Action Buttons - Compact
            BoxLayout:
                orientation: "horizontal"
                spacing: "15dp"  # Reduced spacing
                size_hint_y: None
                height: "60dp"  # Smaller height
                padding: [0, "15dp", 0, 0]  # Less padding
                
                Button:
                    text: "üóëÔ∏è Clear Form"
                    font_size: "14sp"  # Smaller font
                    background_color: 0.8, 0.4, 0.4, 1
                    on_release: root.clear_form()
                    size_hint_x: 0.45
                    
                Widget:
                    size_hint_x: 0.1
                    
                Button:
                    text: "‚úÖ Submit Entry"
                    font_size: "14sp"  # Smaller font
                    background_color: 0.2, 0.6, 0.2, 1
                    on_release: root.submit_entry()
                    size_hint_x: 0.45
                    
            # Status - Compact
            Label:
                id: status
                text: ""
                color: 0.2, 0.6, 0.2, 1
                font_size: "16sp"  # Smaller font
                bold: True
                halign: "center"
                size_hint_y: None
                height: "40dp"  # Smaller height
                text_size: self.size
                
            # Export Section
            BoxLayout:
                orientation: "horizontal"
                spacing: "10dp"
                size_hint_y: None
                height: "50dp"
                padding: [20, 10]
                
                Button:
                    text: "üìä Export to CSV"
                    font_size: "14sp"
                    background_color: 0.4, 0.4, 0.8, 1
                    color: 1, 1, 1, 1
                    on_release: root.export_to_csv()
                    size_hint_x: 0.7
                    
                Label:
                    text: "Export all entries"
                    font_size: "11sp"
                    color: 0.6, 0.6, 0.6, 1
                    size_hint_x: 0.3
                    halign: "left"
                    valign: "center"
                    text_size: self.size
                
            # Bottom spacer - Minimal
            Widget:
                size_hint_y: None
                height: "20dp"  # Much smaller
